# Apache Virtual Host Configuration Template
# Replace {{DOMAIN}}, {{ROOT}}, {{ADMIN_EMAIL}} with actual values

#=============================================================================
# HTTP VIRTUAL HOST
#=============================================================================
<VirtualHost *:80>
    ServerName {{DOMAIN}}
    ServerAlias www.{{DOMAIN}}
    ServerAdmin {{ADMIN_EMAIL|admin@example.com}}
    
    DocumentRoot {{ROOT|/var/www/html}}
    
    #=========================================================================
    # DIRECTORY CONFIGURATION
    #=========================================================================
    <Directory {{ROOT|/var/www/html}}>
        Options -Indexes +FollowSymLinks -MultiViews
        AllowOverride All
        Require all granted
        
        # PHP Configuration
        php_admin_value upload_max_filesize {{UPLOAD_MAX|256M}}
        php_admin_value post_max_size {{POST_MAX|256M}}
        php_admin_value memory_limit {{MEMORY_LIMIT|512M}}
        php_admin_value max_execution_time {{EXEC_TIME|300}}
        php_admin_value max_input_time {{INPUT_TIME|300}}
        
        # Security
        php_admin_flag expose_php Off
        php_admin_flag allow_url_include Off
    </Directory>
    
    #=========================================================================
    # LOGGING
    #=========================================================================
    ErrorLog ${APACHE_LOG_DIR}/{{DOMAIN}}-error.log
    CustomLog ${APACHE_LOG_DIR}/{{DOMAIN}}-access.log combined
    LogLevel warn
    
    #=========================================================================
    # SECURITY HEADERS
    #=========================================================================
    <IfModule mod_headers.c>
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "no-referrer-when-downgrade"
        Header always set Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'"
        
        # Remove server signature
        Header unset Server
        Header unset X-Powered-By
    </IfModule>
    
    #=========================================================================
    # COMPRESSION
    #=========================================================================
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
        AddOutputFilterByType DEFLATE application/javascript application/json
        AddOutputFilterByType DEFLATE application/xml application/xhtml+xml
        AddOutputFilterByType DEFLATE image/svg+xml
        
        # Compress fonts
        AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
        AddOutputFilterByType DEFLATE application/x-font-ttf
        AddOutputFilterByType DEFLATE font/opentype font/ttf font/eot font/otf
    </IfModule>
    
    #=========================================================================
    # BROWSER CACHING
    #=========================================================================
    <IfModule mod_expires.c>
        ExpiresActive On
        
        # Images
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/webp "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        ExpiresByType image/x-icon "access plus 1 year"
        
        # CSS and JavaScript
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType text/javascript "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        
        # Fonts
        ExpiresByType font/ttf "access plus 1 year"
        ExpiresByType font/otf "access plus 1 year"
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/woff2 "access plus 1 year"
        ExpiresByType application/font-woff "access plus 1 year"
        
        # Documents
        ExpiresByType application/pdf "access plus 1 month"
        ExpiresByType application/msword "access plus 1 month"
        ExpiresByType application/vnd.ms-excel "access plus 1 month"
        
        # HTML
        ExpiresByType text/html "access plus 0 seconds"
    </IfModule>
    
    #=========================================================================
    # SECURITY RULES
    #=========================================================================
    # Deny access to hidden files
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    # Deny access to backup and sensitive files
    <FilesMatch "(^#.*#|\.(bak|conf|dist|fla|in[ci]|log|psd|sh|sql|sw[op]|old|orig)|~)$">
        Require all denied
    </FilesMatch>
    
    # Protect configuration files
    <FilesMatch "(composer\.json|package\.json|package-lock\.json|yarn\.lock|\.env)$">
        Require all denied
    </FilesMatch>
    
    #=========================================================================
    # WORDPRESS SPECIFIC (uncomment if using WordPress)
    #=========================================================================
    # Protect wp-config.php
    # <Files wp-config.php>
    #     Require all denied
    # </Files>
    
    # Protect .htaccess
    # <Files .htaccess>
    #     Require all denied
    # </Files>
    
    # Disable PHP in uploads directory
    # <Directory {{ROOT}}/wp-content/uploads>
    #     <FilesMatch "\.php$">
    #         Require all denied
    #     </FilesMatch>
    # </Directory>
    
    # Limit login attempts (requires mod_rewrite)
    # <IfModule mod_rewrite.c>
    #     RewriteEngine On
    #     RewriteCond %{REQUEST_URI} ^(.*)?wp-login\.php(.*)$ [OR]
    #     RewriteCond %{REQUEST_URI} ^(.*)?xmlrpc\.php(.*)$
    #     RewriteRule ^(.*)$ - [F,L]
    # </IfModule>
    
    #=========================================================================
    # CUSTOM REDIRECTS (examples)
    #=========================================================================
    # Redirect www to non-www (or vice versa)
    # <IfModule mod_rewrite.c>
    #     RewriteEngine On
    #     RewriteCond %{HTTP_HOST} ^www\.{{DOMAIN}}$ [NC]
    #     RewriteRule ^(.*)$ http://{{DOMAIN}}/$1 [R=301,L]
    # </IfModule>
    
    # Custom error pages
    # ErrorDocument 404 /404.html
    # ErrorDocument 500 /500.html
    
    #=========================================================================
    # PERFORMANCE TUNING
    #=========================================================================
    # Enable KeepAlive
    KeepAlive On
    MaxKeepAliveRequests 100
    KeepAliveTimeout 5
    
    # Limit request body size
    LimitRequestBody 268435456
    
</VirtualHost>

#=============================================================================
# HTTPS VIRTUAL HOST (uncomment and configure SSL)
#=============================================================================
# <VirtualHost *:443>
#     ServerName {{DOMAIN}}
#     ServerAlias www.{{DOMAIN}}
#     ServerAdmin {{ADMIN_EMAIL}}
#     
#     DocumentRoot {{ROOT}}
#     
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile {{SSL_CERT_PATH|/etc/ssl/certs/example.com.crt}}
#     SSLCertificateKeyFile {{SSL_KEY_PATH|/etc/ssl/private/example.com.key}}
#     SSLCertificateChainFile {{SSL_CHAIN_PATH|/etc/ssl/certs/chain.crt}}
#     
#     # SSL Security
#     SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
#     SSLHonorCipherOrder off
#     SSLCompression off
#     SSLSessionTickets off
#     
#     # HSTS (uncomment if you're sure)
#     # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
#     
#     # OCSP Stapling
#     SSLUseStapling on
#     SSLStaplingCache "shmcb:logs/stapling-cache(150000)"
#     
#     # ... rest of configuration same as HTTP block
# </VirtualHost>

#=============================================================================
# ADDITIONAL NOTES
#=============================================================================
# Required Apache modules:
# - mod_rewrite: a2enmod rewrite
# - mod_headers: a2enmod headers
# - mod_expires: a2enmod expires
# - mod_deflate: a2enmod deflate
# - mod_ssl: a2enmod ssl (for HTTPS)
#
# After editing, test configuration:
# sudo apache2ctl configtest
#
# Reload Apache:
# sudo systemctl reload apache2